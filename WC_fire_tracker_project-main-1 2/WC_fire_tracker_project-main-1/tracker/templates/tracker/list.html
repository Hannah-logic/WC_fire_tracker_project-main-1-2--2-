{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="main-list-wrapper" style="max-width: 900px; margin: 0 auto; padding: 20px;">

    <h1 style="color: #c00; border-bottom: 2px solid #ccc; padding-bottom: 15px; text-transform: capitalize; font-size: 1.5em;">
        Western Cape Fire Tracker Activity
    </h1>

    <h2 style="color: #333; font-size: 1.2em; margin-top: 30px;">
        Tracked Regeneration Sites (User Monitoring)
    </h2>
    
    {% if sites %}
        {% for site in sites %}
        {# ADAPTING THE .eqs CARD STRUCTURE #}
        <div data-id="{{ site.id }}" class="eqs" style="display: flex; border: 1px solid #ddd; margin-bottom: 10px; background: #fff; box-shadow: 2px 2px 5px rgba(0,0,0,0.1);">
            
            {# ADAPTING THE .mag STYLING FOR STATUS #}
            <div class="mag" style="
                background-color: #004d99; /* Use site primary color */
                color: #fff; 
                width: 70px; 
                display: flex; 
                align-items: center; 
                justify-content: center;
                font-size: 1.4em;
                font-weight: 700;
                padding: 10px 0;
            ">
                {% if site.associated_fire %}
                    {{ site.associated_fire.status|slice:":1"|upper }} 
                {% else %}
                    N/A
                {% endif %}
            </div>

            {# ADAPTING THE .eqinfo STYLING FOR TEXT DETAILS #}
            <div class="eqinfo" style="padding: 10px 15px; flex-grow: 1;">
                <div class="p1">
                    <div class="reg" style="font-weight: 700; color: #333; font-size: 1em;">
                        {# Link to the Single Item Detail Page #}
                        <a href="{% url 'incident_detail' site.id %}" style="text-decoration: none; color: #004d99;">
                            {{ site.site_name }}
                        </a>
                    </div>
                </div>
                <div class="p2" style="font-size: 0.8em; color: #666; margin-top: 5px;">
                    <div class="dat" style="display: inline-block; margin-right: 15px;">
                        Tracking Since: {{ site.date_established|date:"Y-m-d" }}
                    </div>
                    <div class="dist" style="display: inline-block;">
                        Associated Fire: {{ site.associated_fire.title|default:'Unknown' }}
                    </div>
                </div>
            </div>

        </div>
        {% endfor %}
    {% else %}
        <p style="color: grey;">No regeneration sites are currently being tracked. Please add one in the Admin.</p>
    {% endif %}

    <h2 style="color: #c00; font-size: 1.2em; margin-top: 40px;">
        Historical Fire Incidents
    </h2>
    {% if incidents %}
        {% for incident in incidents %}
        {# Simple list for historical context #}
        <div class="incident-item" style="padding: 10px 0; border-bottom: 1px dashed #ddd;">
            <span style="color: #c00; font-weight: bold; margin-right: 10px;">{{ incident.date|date:"Y"|default:'N/A' }}</span>
            {{ incident.title }} ({{ incident.location|truncatechars:40 }})
        </div>
        {% endfor %}
    {% else %}
        <p style="color: grey;">No major fire incidents recorded yet.</p>
    {% endif %}

</div>
{% endblock content %}